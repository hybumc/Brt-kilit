<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22#6A453A%22/><rect x=%2210%22 y=%2210%22 width=%2280%22 height=%2280%22 fill=%22#A06B51%22/><rect x=%2220%22 y=%220%22 width=%2260%22 height=%2225%22 fill=%22#7DBE31%22/><rect x=%2220%22 y=%225%22 width=%2260%22 height=%2220%22 fill=%22#8EE336%22/></svg>">
    <title>HY MC - Minecraft Sunucusu</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        :root {
            --kurucu-color: #FFAA00;
            --aktif-color: #55FF55;
            --kapali-color: #FF5555;
            --java-color: #8B4513;
            --admin-color: #8A2BE2; /* Mor tonu */
            --main-font: 'Press Start 2P', cursive;
        }

        /* --- ÖZEL KAYDIRMA ÇUBUĞU --- */
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #222; }
        ::-webkit-scrollbar-thumb {
            background-color: var(--kurucu-color);
            border-radius: 20px;
            border: 3px solid #222;
        }

        body {
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.alphacoders.com/133/1337527.png');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #ffffff; font-family: var(--main-font); text-align: center;
            margin: 0; padding: 40px 20px;
            min-height: 100vh; box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        #yasak-bolge {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; color: red;
            display: none; justify-content: center; align-items: center;
            font-size: 3em; z-index: 9999;
            text-shadow: 0 0 10px red;
        }

        /* YENİ: Sayfa açılış animasyonu */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            position: relative;
            background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px);
            border: 5px solid rgba(255, 255, 255, 0.2); border-radius: 20px;
            padding: 40px; 
            padding-top: 80px; /* DÜZELTME: Butonlar için üstte boşluk bırakıldı */
            max-width: 850px;
            width: 100%;
            box-shadow: 0 0 35px rgba(0,0,0,0.5); margin-bottom: 40px;
            animation: fadeInUp 0.8s ease-out forwards; /* YENİ: Animasyon eklendi */
        }

        /* --- OTURUM & YÖNETİM PANELİ BUTONLARI (DÜZELTİLDİ) --- */
        #auth-container { 
            position: absolute; 
            top: 20px; 
            right: 25px; 
            display: flex; 
            gap: 10px; 
            align-items: center;
        }
        .auth-btn, .user-display-btn { 
            font-family: var(--main-font); 
            font-size: 0.7em; 
            color: #fff; 
            background-color: rgba(0,0,0,0.5); 
            border: 2px solid #fff; 
            padding: 8px 12px; 
            border-radius: 5px; 
            cursor: pointer; 
            transition: all 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .auth-btn:hover, .user-display-btn:hover { background-color: #fff; color: #000; }
        
        /* YENİ: Butonlara tıklama efekti */
        .auth-btn:active, .user-display-btn:active, .modal-button:active, .action-button:active {
            transform: scale(0.97);
        }

        #admin-panel-btn {
            border-color: var(--admin-color);
            text-shadow: 0 0 5px var(--admin-color);
        }
        #admin-panel-btn:hover {
            background-color: var(--admin-color);
            color: #fff;
            box-shadow: 0 0 10px var(--admin-color);
        }

        .user-display { 
            display: flex; 
            align-items: center; 
            gap: 10px;
            flex-wrap: nowrap;
            overflow: hidden;
        }
        #username-display { 
            font-size: 0.8em; 
            color: var(--kurucu-color); 
            text-overflow: ellipsis; 
            overflow: hidden;
            white-space: nowrap;
            max-width: 150px;
            flex-shrink: 1;
        }

        /* --- MODAL --- */
        @keyframes fadeInScaleUp {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-color: rgba(0,0,0,0.8); 
            display: none;
            justify-content: center; align-items: center; z-index: 1000; 
        }
        .modal { 
            background-color: rgba(10, 10, 10, 0.9); border: 3px solid var(--kurucu-color); 
            border-radius: 15px; padding: 30px; width: 90%; max-width: 400px; 
            font-family: var(--main-font); color: #fff; text-align: left; position: relative;
            animation: fadeInScaleUp 0.3s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
        }
        .modal.comments-modal { max-width: 800px; max-height: 80vh; display: flex; flex-direction: column; }
        .modal h3 { text-align: center; font-size: 1.2em; margin-top: 0; margin-bottom: 25px; }
        .modal-form-group { margin-bottom: 15px; }
        .modal-form-group label { font-size: 0.8em; display: block; margin-bottom: 8px; }
        .modal-input { width: 100%; padding: 10px; background-color: #333; border: 2px solid #555; border-radius: 5px; color: #fff; font-family: var(--main-font); font-size: 0.8em; box-sizing: border-box; }
        .modal textarea.modal-input { height: 80px; resize: vertical; }
        .modal-button { width: 100%; padding: 12px; background-color: var(--aktif-color); color: #000; border: none; border-bottom: 4px solid #3c9f3c; border-radius: 5px; font-family: var(--main-font); font-size: 0.9em; cursor: pointer; margin-top: 10px; transition: transform 0.1s ease; }
        .modal-button.secondary { background-color: #777; border-bottom-color: #555; }
        .terms-group { display: flex; align-items: center; margin-top: 15px; font-size: 0.7em; }
        .terms-group input { margin-right: 10px; }
        .terms-group label a { color: var(--kurucu-color); text-decoration: underline; cursor: pointer; }
        #modal-error { color: var(--kapali-color); font-size: 0.7em; text-align: center; height: 20px; margin-bottom: 10px; }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #fff; font-size: 1.5em; cursor: pointer; z-index: 10; }

        /* --- YORUMLAR CSS --- */
        #comment-form-container { border-bottom: 2px solid var(--kurucu-color); padding-bottom: 20px; margin-bottom: 20px; }
        #comments-list { overflow-y: auto; flex-grow: 1; padding-right: 10px; }
        .comment-card { background-color: rgba(0,0,0,0.3); border: 2px solid #444; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .comment-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .comment-header .right-side { display: flex; align-items: center; } 
        .comment-author { font-size: 0.9em; color: var(--aktif-color); }
        .comment-body { font-size: 0.8em; line-height: 1.5; }
        .star-rating { display: flex; direction: rtl; justify-content: center; }
        .star-rating input[type="radio"] { display: none; }
        .star-rating label { font-size: 1.5em; color: #555; cursor: pointer; padding: 0 5px; }
        .star-rating input[type="radio"]:checked ~ label, .star-rating label:hover, .star-rating label:hover ~ label { color: var(--kurucu-color); }
        .comment-card .star-display { font-size: 0.9em; color: var(--kurucu-color); }
        .delete-comment-btn {
            background-color: transparent; border: 1px solid var(--kapali-color); color: var(--kapali-color);
            font-family: var(--main-font); font-size: 0.6em; padding: 3px 6px; border-radius: 4px; cursor: pointer;
            margin-left: 15px; transition: all 0.2s ease;
        }
        .delete-comment-btn:hover { background-color: var(--kapali-color); color: #000; }

        /* --- YÖNETİM PANELİ (YENİLENDİ VE SÜSLENDİ) --- */
        #admin-panel-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: #fff;
            display: none; 
            justify-content: center; align-items: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        #admin-panel-overlay.visible { display: flex; opacity: 1; }
        
        /* YENİ: Yükleniyor yazısı için animasyon */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .admin-loading-screen p { animation: pulse 1.5s infinite; }

        .admin-loading-screen, .admin-dashboard-screen {
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            width: 100%; height: 100%;
            position: absolute;
            transition: opacity 0.5s ease, visibility 0.5s;
        }
        .admin-dashboard-screen {
            opacity: 0; visibility: hidden;
            flex-direction: row; align-items: stretch;
            transform: scale(0.95); /* YENİ: Giriş animasyonu için başlangıç ölçeği */
            transition: opacity 0.4s ease, transform 0.4s ease, visibility 0.4s;
        }
        #admin-panel-overlay.dashboard-visible .admin-loading-screen {
            opacity: 0; visibility: hidden;
        }
        #admin-panel-overlay.dashboard-visible .admin-dashboard-screen {
            opacity: 1; visibility: visible;
            transform: scale(1); /* YENİ: Giriş animasyonu bitişi */
        }
        .admin-sidebar {
            width: 280px;
            /* YENİ: Gradient arka plan ve gölge */
            background: linear-gradient(180deg, rgba(20, 20, 20, 0.95) 0%, rgba(10, 10, 10, 0.8) 100%);
            border-right: 2px solid var(--admin-color);
            box-shadow: 5px 0px 20px rgba(138, 43, 226, 0.2);
            padding: 40px 20px;
            display: flex; flex-direction: column;
            gap: 20px;
            flex-shrink: 0;
        }
        .admin-sidebar-header {
            text-align: center;
            font-size: 1.2em;
            color: var(--admin-color);
            text-shadow: 0 0 8px var(--admin-color);
            padding-bottom: 20px;
            border-bottom: 1px solid #444;
        }
        .admin-sidebar-menu button {
            display: flex; /* YENİ: İkonlar için */
            align-items: center; /* YENİ: İkonlar için */
            gap: 15px; /* YENİ: İkonlar için */
            width: 100%;
            background: none; border: 1px solid #555;
            color: #fff; font-family: var(--main-font);
            font-size: 0.8em; padding: 15px;
            border-radius: 5px; text-align: left;
            cursor: pointer; transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        .admin-sidebar-menu button:hover, .admin-sidebar-menu button.active {
            background-color: var(--admin-color);
            border-color: var(--admin-color);
            color: #fff;
            transform: translateX(10px); /* YENİ: Hover animasyonu */
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5); /* YENİ: Hover gölgesi */
        }
        .admin-main-content {
            flex-grow: 1;
            padding: 40px;
            overflow-y: auto;
        }
        #admin-content-area {
            width: 100%; height: 100%;
        }
        .admin-table-container { overflow-y: auto; flex-grow: 1; margin-top: 20px; }
        .admin-table { width: 100%; border-collapse: collapse; font-size: 0.7em; }
        .admin-table th, .admin-table td { padding: 12px 15px; border: 1px solid #444; text-align: left; word-break: break-word; }
        .admin-table th { background-color: rgba(138,43,226,0.2); }
        .admin-table tr:nth-child(even) { background-color: rgba(255,255,255,0.05); }


        /* --- ANA SAYFA CSS --- */
        .logo { 
            width: 160px; height: 160px; border-radius: 50%; border: 6px solid #888888; 
            object-fit: contain; /* DÜZELTME: Resmin tamamının görünmesini sağlar */
            margin-bottom: 25px; box-shadow: 0 0 20px rgba(0,0,0,0.7);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            background-color: rgba(0,0,0,0.3); /* YENİ: PNG'nin arkası boşsa diye */
        }
        .logo:hover { transform: rotate(10deg) scale(1.05); }
        h1, h2 { text-shadow: 4px 4px 0px #000; }
        h1 { font-size: 2em; letter-spacing: 2px; }
        h2 { font-size: 1.6em; margin-top: 40px; margin-bottom: 20px; }
        @keyframes rainbow-glow { 0%, 100% { border-color: #ff0000; box-shadow: 0 0 20px #ff0000; } 15% { border-color: #ff7f00; box-shadow: 0 0 20px #ff7f00; } 30% { border-color: #ffff00; box-shadow: 0 0 20px #ffff00; } 45% { border-color: #00ff00; box-shadow: 0 0 20px #00ff00; } 60% { border-color: #0000ff; box-shadow: 0 0 20px #0000ff; } 75% { border-color: #4b0082; box-shadow: 0 0 20px #4b0082; } 90% { border-color: #9400d3; box-shadow: 0 0 20px #9400d3; } }
        .connection-info { background-color: rgba(0, 0, 0, 0.4); border: 3px solid; padding: 25px; border-radius: 10px; min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 15px; animation: rainbow-glow 3s linear infinite; }
        #server-ip { font-size: 1.1em; word-break: break-all; }
        #server-version { font-size: 1em; color: #ccc; }
        .server-status { font-size: 1.1em; text-shadow: 0 0 8px; padding: 8px 12px; border-radius: 5px; }
        .server-status.active { color: var(--aktif-color); background-color: rgba(85, 255, 85, 0.1); text-shadow: 0 0 8px var(--aktif-color); }
        .server-status.inactive { color: var(--kapali-color); background-color: rgba(255, 85, 85, 0.1); text-shadow: 0 0 8px var(--kapali-color); }
        .loader {
            width: 60px; height: 60px;
            border: 6px solid #555;
            border-bottom-color: var(--aktif-color);
            border-radius: 50%; display: inline-block;
            box-sizing: border-box; animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .founders-section { margin-top: 40px; }
        .founders-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); justify-items: center; gap: 25px; margin-top: 25px; }
        .founder-card { background-color: rgba(0, 0, 0, 0.4); padding: 20px; border-radius: 10px; border: 3px solid; transition: all 0.3s ease; width: 150px; animation: rainbow-glow 3s linear infinite; }
        .founder-card:hover { transform: translateY(-5px); background-color: rgba(0, 0, 0, 0.6); }
        .founder-avatar { width: 80px; height: 80px; border-radius: 8px; margin-bottom: 15px; image-rendering: pixelated; }
        .founder-name { font-size: 1em; margin: 0 0 5px 0; }
        .founder-rank { font-size: 0.8em; color: var(--kurucu-color); margin: 0; }
        .footer { margin-top: 40px; font-size: 0.8em; color: #bbbbbb; text-shadow: 1px 1px 0 #000; }
        .online-players-section { margin-top: 40px; }
        #online-players-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 20px; margin-top: 25px; }
        .online-player-card { background-color: rgba(0, 0, 0, 0.4); padding: 15px; border-radius: 10px; border: 2px solid #555; transition: all 0.3s ease; }
        .online-player-card:hover { transform: translateY(-5px); border-color: var(--kurucu-color); }
        .online-player-avatar { width: 50px; height: 50px; border-radius: 5px; margin-bottom: 10px; image-rendering: pixelated; }
        .online-player-name { font-size: 0.8em; margin: 0; word-break: break-all; }
        .action-buttons-container { display: flex; gap: 10px; margin-top: 15px; justify-content: center; align-items: flex-start; }
        .action-button { 
            font-family: var(--main-font); font-size: 0.8em; color: #fff; padding: 10px 15px; 
            border-radius: 8px; border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: all 0.2s ease;
        }
        .action-button:hover { filter: brightness(1.2); }
        .action-button#copy-button { background-color: #5555FF; border-bottom: 4px solid #0000AA; }
        .action-button#mobile-java-btn { background-color: #8B4513; border-bottom: 4px solid #5a2d0c; }
        .action-button#about-btn { background-color: #6a0dad; border-bottom: 4px solid #4b0082; }
    </style>
</head>
<body oncontextmenu="return false;">
    
    <div id="yasak-bolge">YASAK BÖLGE</div>

    <div class="container">
        <div id="auth-container"></div>
        <img src="hymc.png" alt="HY MC Logo" class="logo">
        <h1>HY MC Sunucusuna Hoş Geldin!</h1>
        <div class="connection-info" id="connection-info-container"></div>
        <div class="founders-section">
            <h2>Sunucudaki Kişiler</h2>
            <div class="founders-grid" id="founders-grid">
                 <div class="founder-card">
                    <img src="https://mc-heads.net/avatar/brtmc/80" alt="brtmc skin" class="founder-avatar">
                    <h3 class="founder-name">brtmc</h3>
                    <p class="founder-rank">Bu Üye Ayrılmıştır</p>
                </div>
                <div class="founder-card">
                    <img src="https://mc-heads.net/avatar/Hasan/80" alt="Hasan skin" class="founder-avatar">
                    <h3 class="founder-name">Hasan</h3>
                    <p class="founder-rank">Kurucu</p>
                </div>
                <div class="founder-card">
                    <img src="https://mc-heads.net/avatar/YunusEmre016/80" alt="YunusEmre016 skin" class="founder-avatar">
                    <h3 class="founder-name">YunusEmre016</h3>
                    <p class="founder-rank">Premium Üye</p>
                </div>
                <div class="founder-card">
                    <img src="https://mc-heads.net/avatar/TheUmut/80" alt="TheUmut skin" class="founder-avatar">
                    <h3 class="founder-name">TheUmutt</h3>
                    <p class="founder-rank">Bu Üye Yasaklanmıştır</p>
                </div>
            </div>
        </div>
        <div class="online-players-section" id="online-players-section" style="display: none;">
             <h2>Aktif Oyuncular</h2>
             <div id="online-players-grid"></div>
        </div>
        <div class="footer">
            <p>© 2025 HY MC. Bütün Hakları Saklıdır.</p>
        </div>
    </div>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal" id="modal-content"></div>
    </div>

    <div id="admin-panel-overlay">
        <div class="admin-loading-screen">
            <div class="loader"></div>
            <p>Kontrol Paneli Yükleniyor...</p>
        </div>
        <div class="admin-dashboard-screen">
            <div class="admin-sidebar">
                <div class="admin-sidebar-header">HY MC</div>
                <div class="admin-sidebar-menu">
                    <button id="admin-menu-dashboard">📊 Dashboard</button>
                    <button id="admin-menu-comments">💬 Yorumları Yönet</button>
                </div>
            </div>
            <div class="admin-main-content">
                <div id="admin-content-area">
                    <h2>Yönetim Paneline Hoş Geldiniz</h2>
                    <p>Lütfen soldaki menüden bir işlem seçin.</p>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // --- SUPABASE AYARLARI ---
        const SUPABASE_URL = 'https://myapdyyizzkeuqzfvwjf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15YXBkeXlpenprZXVxemZ2d2pmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyMTI4NTksImV4cCI6MjA2OTc4ODg1OX0.KF0xJ1FbVQ1l4D1Gp9M1-VU9rglUiHCiakz1e5juGrY';
        const supabase = self.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- DOM Elementleri ---
        const authContainer = document.getElementById('auth-container');
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const connectionInfoContainer = document.getElementById('connection-info-container');
        const onlinePlayersSection = document.getElementById('online-players-section');
        const onlinePlayersGrid = document.getElementById('online-players-grid');
        const adminPanelOverlay = document.getElementById('admin-panel-overlay');
        const adminContentArea = document.getElementById('admin-content-area');
        
        // --- Sunucu Bilgileri ---
        const javaIp = 'emerald.magmanode.com:28005';
        const javaVersion = '1.20.1 Java';
        
        // --- ARAYÜZ GÜNCELLEME (ADMİN KONTROLÜ İLE) ---
        async function updateUI(user, profile) {
            if (user) {
                const username = profile?.username || user.user_metadata?.username || user.email;
                let adminButtonHTML = '';
                if (profile && profile.role === 'admin') {
                    adminButtonHTML = `<button id="admin-panel-btn" class="user-display-btn">🛡️ Kontrol Paneli</button>`;
                }
                authContainer.innerHTML = `
                    <div class="user-display">
                        <span id="username-display">${username}</span>
                        ${adminButtonHTML}
                        <button id="comments-btn" class="user-display-btn">Yorumlar</button>
                        <button id="settings-btn" class="user-display-btn">Ayarlar</button>
                    </div>`;
            } else {
                authContainer.innerHTML = `<button id="login-btn" class="auth-btn">Giriş Yap</button><button id="register-btn" class="auth-btn">Kayıt Ol</button>`;
            }
        }
        
        // --- MODAL İŞLEMLERİ ---
        function openModal(htmlContent, modalType = 'default') {
            modalContent.innerHTML = htmlContent;
            modalContent.className = 'modal';
            if (modalType === 'comments') modalContent.classList.add('comments-modal');
            modalOverlay.style.display = 'flex'; 
        }
        function closeModal() { 
            modalOverlay.style.display = 'none'; 
            modalContent.innerHTML = ''; 
            modalContent.className = 'modal';
        }
        
        // --- MODAL İÇERİKLERİ (EKSİKSİZ) ---
        const registerModalHTML = `
            <button class="modal-close-btn" onclick="closeModal()">×</button>
            <h3>Hesap Oluştur</h3>
            <div id="modal-error"></div>
            <form id="register-form">
                <div class="modal-form-group"> <label for="reg-username">Kullanıcı Adı</label> <input type="text" id="reg-username" class="modal-input" required> </div>
                <div class="modal-form-group"> <label for="reg-email">E-posta</label> <input type="email" id="reg-email" class="modal-input" required> </div>
                <div class="modal-form-group"> <label for="reg-password">Şifre</label> <input type="password" id="reg-password" class="modal-input" minlength="6" required> </div>
                <div class="terms-group">
                    <input type="checkbox" id="terms-checkbox" required>
                    <label for="terms-checkbox">
                        <a id="open-terms-link">Kullanım Şartları</a>'nı ve <a id="open-privacy-link">Gizlilik Politikası</a>'nı okudum ve kabul ediyorum.
                    </label>
                </div>
                <button type="submit" class="modal-button">Kayıt Ol</button>
            </form>`;
        const loginModalHTML = `<button class="modal-close-btn" onclick="closeModal()">×</button> <h3>Giriş Yap</h3> <div id="modal-error"></div> <form id="login-form"> <div class="modal-form-group"> <label for="login-email">E-posta</label> <input type="email" id="login-email" class="modal-input" required> </div> <div class="modal-form-group"> <label for="login-password">Şifre</label> <input type="password" id="login-password" class="modal-input" required> </div> <button type="submit" class="modal-button">Giriş Yap</button> </form>`;
        const settingsModalHTML = `<button class="modal-close-btn" onclick="closeModal()">×</button> <h3>Ayarlar</h3> <p style="font-size:0.8em;">Şifre değiştirmek için Supabase projenizin ayarlarından "Email Templates" bölümünü yapılandırmanız gerekir.</p> <button id="logout-btn" class="modal-button secondary" style="margin-top: 15px;">Çıkış Yap</button>`;
        const termsModalHTML = `<button class="modal-close-btn" onclick="openModal(registerModalHTML)">← Geri</button><h3>Kullanım Şartları</h3><div style="font-size:0.7em; line-height:1.6; max-height: 50vh; overflow-y:auto; padding-right:10px;"><p>1. Bu siteye ve sunucuya kayıt olarak tüm kuralları kabul etmiş sayılırsınız.</p><p>2. Saygı: Diğer oyunculara, yöneticilere karşı saygılı olun. Küfür, hakaret, ırkçılık ve aşağılayıcı dil kullanmak yasaktır.</p><p>3. Hile ve Kötüye Kullanım: Oyun içi hataları (glitch/bug) kötüye kullanmak, hile yazılımları kullanmak kalıcı yasaklanma sebebidir.</p><p>4. Hesap Güvenliği: Hesap güvenliğinizden siz sorumlusunuz. Hesap bilgilerinizi kimseyle paylaşmayın.</p><p>5. Yönetim: Yönetim ekibinin kararları nihaidir. Yöneticileri gereksiz yere rahatsız etmekten kaçının.</p></div>`;
        const privacyModalHTML = `<button class="modal-close-btn" onclick="openModal(registerModalHTML)">← Geri</button><h3>Gizlilik Politikası</h3><div style="font-size:0.7em; line-height:1.6; max-height: 50vh; overflow-y:auto; padding-right:10px;"><p>Verilerinizin güvenliği bizim için önemlidir. Bu site, kullanıcı kimlik doğrulama işlemleri için güvenilir bir altyapı olan <strong>Supabase</strong> hizmetini kullanmaktadır.</p><p><strong>Toplanan Veriler:</strong> Kayıt sırasında girdiğiniz e-posta adresi, kullanıcı adı ve şifreniz (güvenli bir şekilde şifrelenmiş/hashlenmiş olarak) Supabase veritabanında saklanır.</p><p><strong>Veri Kullanımı:</strong> Bu bilgiler yalnızca siteye giriş yapabilmeniz, kimliğinizi doğrulamanız ve yorumlar gibi site özelliklerini kullanabilmeniz için kullanılır. Bilgileriniz asla üçüncü partilerle paylaşılmaz veya satılmaz.</p><p><strong>Çerezler (Cookies):</strong> Oturumunuzu açık tutmak gibi temel işlevler için anonim çerezler kullanılabilir.</p></div>`;

        // --- YÖNETİM PANELİ İŞLEVLERİ (YENİ) ---
        async function openAdminPanel() {
            adminPanelOverlay.classList.add('visible');
            setTimeout(() => {
                adminPanelOverlay.classList.add('dashboard-visible');
            }, 2000); // 2 saniye bekle
        }

        async function loadAllCommentsForAdmin() {
            adminContentArea.innerHTML = '<div class="loader"></div>';
            const { data, error } = await supabase.from('comments').select('*').order('created_at', { ascending: false });

            if (error) {
                adminContentArea.innerHTML = `<h2>Yorum Yönetimi</h2><p>Yorumlar yüklenemedi: ${error.message}</p>`;
                return;
            }
            if (data.length === 0) {
                adminContentArea.innerHTML = `<h2>Yorum Yönetimi</h2><p>Sitede hiç yorum bulunmuyor.</p>`;
                return;
            }

            const tableRows = data.map(comment => `
                <tr>
                    <td>${comment.username || 'Bilinmiyor'}</td>
                    <td>${comment.comment_text}</td>
                    <td>${'★'.repeat(comment.rating || 0)}${'☆'.repeat(5 - (comment.rating || 0))}</td>
                    <td>${new Date(comment.created_at).toLocaleString('tr-TR')}</td>
                    <td><button class="delete-comment-btn" data-id="${comment.id}" style="margin-left:0;">Sil</button></td>
                </tr>`).join('');

            adminContentArea.innerHTML = `
                <h2>Yorum Yönetimi</h2>
                <div class="admin-table-container">
                    <table class="admin-table">
                        <thead><tr><th>Kullanıcı</th><th>Yorum</th><th>Puan</th><th>Tarih</th><th>İşlem</th></tr></thead>
                        <tbody>${tableRows}</tbody>
                    </table>
                </div>`;
        }
        
        // --- YORUM SİSTEMİ İŞLEVLERİ (EKSİKSİZ) ---
        async function openCommentsModal() {
            const { data: { user } } = await supabase.auth.getUser();
            let formHtml = `<p style="font-size:0.8em; text-align:center;">Yorum yapmak için giriş yapmalısınız.</p>`;

            if (user) {
                formHtml = `
                    <div id="comment-form-container">
                        <div id="modal-error"></div>
                        <form id="comment-form">
                            <div class="modal-form-group"><label for="comment-text">Yorumunuz</label><textarea id="comment-text" class="modal-input" required></textarea></div>
                            <div class="modal-form-group">
                                <label>Puanınız</label>
                                <div class="star-rating">
                                    <input type="radio" id="star5" name="rating" value="5" required/><label for="star5">☆</label>
                                    <input type="radio" id="star4" name="rating" value="4" /><label for="star4">☆</label>
                                    <input type="radio" id="star3" name="rating" value="3" /><label for="star3">☆</label>
                                    <input type="radio" id="star2" name="rating" value="2" /><label for="star2">☆</label>
                                    <input type="radio" id="star1" name="rating" value="1" /><label for="star1">☆</label>
                                </div>
                            </div>
                            <button type="submit" class="modal-button">Yorumu Gönder</button>
                        </form>
                    </div>`;
            }
            const fullModalHtml = `
                <button class="modal-close-btn" onclick="closeModal()">×</button>
                <h3>Yorumlar ve Değerlendirmeler</h3>
                ${formHtml}
                <div id="comments-list"><div class="loader"></div></div>`;
            openModal(fullModalHtml, 'comments');
            loadComments();
        }

        async function loadComments() {
            const commentsList = document.getElementById('comments-list');
            if (!commentsList) return;
            const { data: { user } } = await supabase.auth.getUser();
            const currentUserId = user ? user.id : null;
            const { data, error } = await supabase.from('comments').select('*').order('created_at', { ascending: false });
            if (error) { commentsList.innerHTML = `<p>Yorumlar yüklenirken bir hata oluştu.</p>`; return; }
            if (data.length === 0) { commentsList.innerHTML = `<p>Henüz hiç yorum yapılmamış. İlk yorumu sen yap!</p>`; return; }
            commentsList.innerHTML = data.map(comment => {
                const deleteButtonHtml = currentUserId === comment.user_id ? `<button class="delete-comment-btn" data-id="${comment.id}">Sil</button>` : '';
                return `<div class="comment-card"><div class="comment-header"><span class="comment-author">${comment.username || 'Anonim'}</span><div class="right-side"><span class="star-display">${'★'.repeat(comment.rating || 0)}${'☆'.repeat(5 - (comment.rating || 0))}</span>${deleteButtonHtml}</div></div><p class="comment-body">${comment.comment_text}</p></div>`;
            }).join('');
        }

        async function handleCommentSubmit(e) {
            e.preventDefault();
            const errorDiv = document.getElementById('modal-error');
            const commentText = document.getElementById('comment-text').value;
            const rating = document.querySelector('input[name="rating"]:checked');
            if (!rating) { errorDiv.textContent = 'Lütfen bir puan seçin.'; return; }
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) { errorDiv.textContent = 'Yorum yapmak için giriş yapmalısınız.'; return; }
            const { data: profile } = await supabase.from('profiles').select('username').eq('id', user.id).single();
            const { error } = await supabase.from('comments').insert([{ 
                comment_text: commentText, 
                rating: rating.value, 
                user_id: user.id, 
                username: profile?.username 
            }]);
            if (error) { errorDiv.textContent = `Yorum gönderilemedi: ${error.message}`; } 
            else { e.target.reset(); loadComments(); }
        }
        
        // --- GERİ KALAN TÜM JS KODU (DEĞİŞTİRİLMEDİ) ---
        // Not: Kodun geri kalanı, işlevselliği bozmamak adına orijinal haliyle bırakılmıştır.
        // Sadece event listener'ların atandığı bölüm aşağıdadır.
        
        document.addEventListener('DOMContentLoaded', async () => {
            connectionInfoContainer.innerHTML = '<div class="loader"></div>';
            
            async function checkServerStatus() {
                try {
                    const response = await fetch(`https://api.mcstatus.io/v2/status/java/${javaIp}`);
                    const data = await response.json();
                    
                    let statusClass = data.online ? 'active' : 'inactive';
                    let statusText = data.online ? `Aktif (${data.players.online}/${data.players.max})` : 'Kapalı';

                    connectionInfoContainer.innerHTML = `
                        <p id="server-ip">${javaIp}</p>
                        <p id="server-version">${javaVersion}</p>
                        <span class="server-status ${statusClass}">${statusText}</span>
                        <div class="action-buttons-container">
                             <button id="copy-button" class="action-button">📋 Kopyala</button>
                        </div>`;

                    if (data.online && data.players.list && data.players.list.length > 0) {
                        onlinePlayersSection.style.display = 'block';
                        onlinePlayersGrid.innerHTML = data.players.list.map(player => `
                            <div class="online-player-card">
                                <img src="https://mc-heads.net/avatar/${player.name_raw}/50" alt="${player.name_raw}" class="online-player-avatar">
                                <p class="online-player-name">${player.name_clean}</p>
                            </div>
                        `).join('');
                    } else {
                        onlinePlayersSection.style.display = 'none';
                    }

                } catch (error) {
                    connectionInfoContainer.innerHTML = `<p>Sunucu durumu alınamadı.</p><p id="server-ip">${javaIp}</p>`;
                }
            }
            
            const { data: { session } } = await supabase.auth.getSession();
            let userProfile = null;
            if (session) {
                const { data, error } = await supabase.from('profiles').select('*').eq('id', session.user.id).single();
                if (!error) userProfile = data;
            }
            updateUI(session?.user, userProfile);
            await checkServerStatus();
            setInterval(checkServerStatus, 60000);
        });

        document.addEventListener('click', async (e) => {
            const errorDiv = document.getElementById('modal-error');
            if (e.target.id === 'register-btn') openModal(registerModalHTML);
            if (e.target.id === 'login-btn') openModal(loginModalHTML);
            if (e.target.id === 'settings-btn') openModal(settingsModalHTML);
            if (e.target.id === 'comments-btn') openCommentsModal();
            if (e.target.id === 'open-terms-link') openModal(termsModalHTML);
            if (e.target.id === 'open-privacy-link') openModal(privacyModalHTML);
            
            if (e.target.id === 'copy-button') {
                navigator.clipboard.writeText(javaIp).then(() => {
                    e.target.textContent = 'Kopyalandı!';
                    setTimeout(() => { e.target.textContent = '📋 Kopyala'; }, 2000);
                });
            }

            if (e.target.id === 'logout-btn') {
                await supabase.auth.signOut();
                location.reload();
            }

            if (e.target.id === 'admin-panel-btn') openAdminPanel();

            if (e.target.closest('.admin-sidebar-menu')) {
                const button = e.target.closest('button');
                if (!button) return;
                
                document.querySelectorAll('.admin-sidebar-menu button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                if (button.id === 'admin-menu-comments') {
                    loadAllCommentsForAdmin();
                } else if (button.id === 'admin-menu-dashboard') {
                    adminContentArea.innerHTML = '<h2>Dashboard</h2><p>Genel bakış ve istatistikler burada gösterilecek.</p>';
                }
            }

            if (e.target.classList.contains('delete-comment-btn')) {
                const commentId = e.target.dataset.id;
                if (confirm('Bu yorumu silmek istediğinizden emin misiniz?')) {
                    const { error } = await supabase.from('comments').delete().eq('id', commentId);
                    if (error) {
                        alert('Yorum silinemedi: ' + error.message);
                    } else {
                        if (document.getElementById('comments-list')) {
                            loadComments();
                        }
                        if(document.querySelector('.admin-table')) {
                            loadAllCommentsForAdmin();
                        }
                    }
                }
            }
        });

        document.addEventListener('submit', async (e) => {
            const errorDiv = document.getElementById('modal-error');
            if (e.target.id === 'register-form') {
                e.preventDefault();
                const username = document.getElementById('reg-username').value;
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                
                const { data: { user }, error: signUpError } = await supabase.auth.signUp({ email, password });
                if (signUpError) { errorDiv.textContent = signUpError.message; return; }
                if (user) {
                    const { error: profileError } = await supabase.from('profiles').insert([{ id: user.id, username: username, role: 'user' }]);
                    if (profileError) { errorDiv.textContent = `Profil oluşturulamadı: ${profileError.message}`; return; }
                    alert('Kayıt başarılı! Lütfen e-postanızı kontrol ederek hesabınızı doğrulayın.');
                    closeModal();
                }
            }
            if (e.target.id === 'login-form') {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) { errorDiv.textContent = error.message; }
                else { location.reload(); }
            }
            if (e.target.id === 'comment-form') {
                handleCommentSubmit(e);
            }
        });

        modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) closeModal(); });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
                document.getElementById('yasak-bolge').style.display = 'flex';
                e.preventDefault();
            }
            if (e.key === 'Escape') {
                if (adminPanelOverlay.classList.contains('visible')) {
                    adminPanelOverlay.classList.remove('dashboard-visible');
                    adminPanelOverlay.classList.remove('visible');
                } else if (modalOverlay.style.display === 'flex') {
                    closeModal();
                }
            }
        });

    </script>
</body>
</html>
